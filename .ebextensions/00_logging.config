# .ebextensions/00_logging.config
option_settings:
  aws:elasticbeanstalk:container:nodejs:
    NodeCommand: "npm start"
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: "production"
    LOG_DIR: "/var/log/nodejs"

files:
  "/etc/logrotate.d/nodejs":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/log/nodejs/*.log {
        daily
        missingok
        rotate 14
        compress
        delaycompress
        notifempty
        create 0640 root root
        sharedscripts
        postrotate
          pm2 reload all > /dev/null
        endscript
      }

container_commands:
  01_create_log_dir:
    command: "mkdir -p /var/log/nodejs && chown -R webapp:webapp /var/log/nodejs"
  02_chown_logs:
    command: "chown -R webapp:webapp /var/log/nodejs"
